<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Список билетов</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
  <style>
    body {
        background-color: #f8f9fa;
        padding: 0;
        margin: 0;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

        nav {
            background: linear-gradient(135deg, #343a40, #495057);
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        nav a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1.5rem;
            margin: 0 0.5rem;
            border-radius: 5px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        nav a:hover {
            background-color: rgba(255,255,255,0.1);
            transform: translateY(-2px);
        }

    .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 20px;
    }

    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding-bottom: 15px;
        border-bottom: 2px solid #e9ecef;
    }

    h1 {
        margin-bottom: 20px;
        color: #343a40;
        font-size: 1.8rem;
    }

    .btn {
        padding: 10px 20px;
        border-radius: 5px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        border: none;
        text-decoration: none;
        display: inline-block;
        text-align: center;
        font-size: 0.9rem;
    }

    .btn-primary {
        background: linear-gradient(135deg, #d63384, #c2185b);
        color: white !important;
    }

    .btn-primary:hover {
        background: linear-gradient(135deg, #c2185b, #ad1457);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(214, 51, 132, 0.3);
    }

    .btn-secondary {
        background: linear-gradient(135deg, #6c757d, #545b62);
        color: white !important;
    }

    .btn-secondary:hover {
        background: linear-gradient(135deg, #545b62, #3d4246);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(108,117,125,0.3);
    }

    .btn-warning {
        background: linear-gradient(135deg, #ffc107, #e0a800);
        color: #212529 !important;
    }

    .btn-warning:hover {
        background: linear-gradient(135deg, #e0a800, #d39e00);
    }

    .btn-danger {
        background: linear-gradient(135deg, #dc3545, #c82333);
        color: white !important;
    }

    .btn-danger:hover {
        background: linear-gradient(135deg, #c82333, #bd2130);
    }

    /* Стили для схемы зала */
    .hall-layout {
        text-align: center;
        margin: 20px 0;
        padding: 30px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        border-left: 4px solid #d63384;
    }

    .screen {
        background: linear-gradient(135deg, #d63384, #e685b5);
        color: white;
        padding: 20px;
        margin: 0 auto 40px auto;
        border-radius: 10px;
        width: 70%;
        font-weight: bold;
        font-size: 1.2rem;
        box-shadow: 0 4px 15px rgba(214, 51, 132, 0.3);
    }

    .seating-grid {
        display: inline-block;
        margin-bottom: 30px;
    }

    .seat-row {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
        justify-content: center;
    }

    .row-number {
        width: 60px;
        font-weight: bold;
        color: #495057;
        margin-right: 15px;
        font-size: 0.9rem;
    }

    .seat {
        width: 40px;
        height: 40px;
        margin: 3px;
        background: #28a745;
        color: white;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 0.8rem;
        font-weight: bold;
        transition: all 0.3s ease;
        border: 2px solid transparent;
    }

    .seat.available:hover {
        background: #218838;
        transform: scale(1.15);
        border-color: #d63384;
        box-shadow: 0 2px 8px rgba(214, 51, 132, 0.4);
    }

    .seat.occupied {
        background: #dc3545;
        cursor: not-allowed;
        opacity: 0.7;
    }

    .seat.selected {
        background: #d63384;
        transform: scale(1.15);
        border-color: #c2185b;
        box-shadow: 0 2px 10px rgba(214, 51, 132, 0.5);
    }

    .seat-info {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        border-left: 4px solid #d63384;
    }

    .stats-card {
        background: white;
        border-radius: 10px;
        padding: 25px;
        margin-bottom: 25px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        border-left: 4px solid #d63384;
    }

    .filter-section {
        background: white;
        padding: 25px;
        border-radius: 10px;
        margin-bottom: 25px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        border-left: 4px solid #6c757d;
    }

    .session-info {
        background: linear-gradient(135deg, #d63384, #e685b5);
        color: white;
        padding: 25px;
        border-radius: 10px;
        margin-bottom: 25px;
        box-shadow: 0 4px 15px rgba(214, 51, 132, 0.3);
    }

    .price-breakdown {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 15px;
        margin-top: 15px;
        border-left: 3px solid #d63384;
    }

    .alert {
        padding: 15px 20px;
        border-radius: 8px;
        margin-bottom: 25px;
        border: none;
    }

    .alert-success {
        background-color: #d4edda;
        color: #155724;
        border-left: 4px solid #28a745;
    }

    .alert-danger {
        background-color: #f8d7da;
        color: #721c24;
        border-left: 4px solid #dc3545;
    }

    .alert-info {
        background-color: #d1ecf1;
        color: #0c5460;
        border-left: 4px solid #17a2b8;
    }

    .table {
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .table thead th {
        background: linear-gradient(135deg, #d63384, #e685b5);
        color: white;
        border: none;
        padding: 15px;
        font-weight: 600;
    }

    .table tbody tr:hover {
        background-color: rgba(214, 51, 132, 0.05);
    }

    .badge {
        padding: 6px 12px;
        border-radius: 20px;
        font-weight: 500;
    }

    .bg-success {
        background: linear-gradient(135deg, #28a745, #20c997) !important;
    }

    .bg-warning {
        background: linear-gradient(135deg, #ffc107, #fd7e14) !important;
    }

    .bg-info {
        background: linear-gradient(135deg, #17a2b8, #6f42c1) !important;
    }

    .form-select:focus,
    .form-control:focus {
        border-color: #d63384;
        box-shadow: 0 0 0 0.2rem rgba(214, 51, 132, 0.25);
    }

    .modal-header {
        background: linear-gradient(135deg, #d63384, #e685b5);
        color: white;
        border-bottom: none;
    }

    .modal-footer {
        border-top: 1px solid #e9ecef;
        padding: 20px;
    }

    .price-display {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        border-left: 4px solid #d63384;
    }

    @media (max-width: 768px) {
        .container {
            padding: 20px;
        }

        nav {
            text-align: center;
        }

        nav a {
            display: inline-block;
            margin: 5px;
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }

        .screen {
            width: 90%;
            padding: 15px;
            font-size: 1rem;
        }

        .seat {
            width: 35px;
            height: 35px;
            font-size: 0.7rem;
        }

        .row-number {
            width: 50px;
            font-size: 0.8rem;
        }
    }
  </style>
</head>
<body>
<nav>
  <a href="/films">Фильмы</a>
  <a href="/halls">Залы</a>
  <a href="/sessions">Сеансы</a>
  <a href="/tickets">Билеты</a>
  <a href="/orders" class="active">Заказы</a>
  <a href="/users">Пользователи</a>
</nav>

<div class="container mt-4">
  <h1 class="mb-4">Управление билетами</h1>

  <!-- Фильтр по сеансам -->
  <div class="filter-section">
    <form method="get" th:action="@{/tickets}">
      <div class="row">
        <div class="col-md-6">
          <label for="sessionSelect" class="form-label">Выберите сеанс:</label>
          <select id="sessionSelect" name="sessionId" class="form-select" onchange="this.form.submit()">
            <option value="">Все сеансы</option>
            <option th:each="cinemaSessionItem : ${cinemaSessions}"
                    th:value="${cinemaSessionItem.sessionId}"
                    th:text="${cinemaSessionItem.film.name + ' - ' + cinemaSessionItem.date + ' ' + cinemaSessionItem.startTime + ' (Зал ' + cinemaSessionItem.hall.hallId + ')'}"
                    th:selected="${selectedSessionId == cinemaSessionItem.sessionId}">
            </option>
          </select>
        </div>
      </div>
    </form>
  </div>

  <!-- Статистика -->
  <div th:if="${stats}" class="stats-card">
    <h5>Статистика сеанса</h5>
    <div class="row">
      <div class="col-md-3">
        <strong>Всего мест:</strong> <span th:text="${stats.totalSeats}">0</span>
      </div>
      <div class="col-md-3">
        <strong>Куплено:</strong> <span th:text="${stats.purchasedTickets}">0</span>
      </div>
      <div class="col-md-3">
        <strong>Свободно:</strong> <span th:text="${stats.availableSeats}">0</span>
      </div>
      <div class="col-md-3">
        <strong>Заполненность:</strong>
        <span th:text="${#numbers.formatDecimal(stats.occupancyRate, 1, 2)} + '%'">0%</span>
      </div>
    </div>
  </div>

  <!-- Схема зала -->
  <div th:if="${seatingChart != null}">
    <div class="session-info">
      <h4 th:text="'Сеанс: ' + ${cinemaSession.film.name} + ' - ' + ${cinemaSession.date} + ' ' + ${cinemaSession.startTime}"></h4>
      <p th:text="'Зал: ' + ${cinemaSession.hall.hallId} + ' | Всего мест: ' + ${cinemaSession.hall.numberSeats}"></p>
      <p th:if="${cinemaSession.cost != null}"
         th:text="'Базовая цена: ' + ${#numbers.formatDecimal(cinemaSession.cost, 1, 'DEFAULT', 2, 'DEFAULT')} + ' ₽'"></p>
    </div>

    <div class="hall-layout">
      <div class="screen">🎬 ЭКРАН 🎬</div>

      <!-- Легенда -->
      <div class="row justify-content-center mb-3">
        <div class="col-auto">
          <div class="d-flex align-items-center">
            <div class="seat available me-2"></div>
            <span>Свободно</span>
          </div>
        </div>
        <div class="col-auto">
          <div class="d-flex align-items-center">
            <div class="seat occupied me-2"></div>
            <span>Занято</span>
          </div>
        </div>
        <div class="col-auto">
          <div class="d-flex align-items-center">
            <div class="seat selected me-2"></div>
            <span>Выбрано</span>
          </div>
        </div>
      </div>

      <div class="seating-grid">
        <div th:each="rowEntry : ${seatingChart}" class="seat-row">
          <div class="row-number">Ряд [[${rowEntry.key}]]</div>
          <div th:each="ticket : ${rowEntry.value}"
               class="seat"
               th:classappend="${ticket.isPurchased} ? 'occupied' : 'available'"
               th:attr="data-ticketid=${ticket.ticketId},
                        data-row=${ticket.row},
                        data-seat=${ticket.seat},
                        data-sessionid=${ticket.session.sessionId}"
               th:onclick="${ticket.isPurchased} ? '' : 'selectSeat(this)'">
            [[${ticket.seat}]]
          </div>
        </div>
      </div>

      <!-- Информация о выбранном месте -->
      <div id="selectedSeatInfo" class="seat-info" style="display: none;">
        <h5>Выбрано место: <span id="selectedSeatText"></span></h5>
        <div class="price-info">
          <p class="mb-1">Цена:
            <span id="basePriceDisplay" class="text-muted"></span>
            <span id="finalPriceDisplay" class="fw-bold fs-5 ms-2"></span>
          </p>
          <div id="discountDetails" class="price-breakdown"></div>
        </div>
        <button type="button" class="btn btn-primary mt-2" data-bs-toggle="modal" data-bs-target="#purchaseModal">
          Купить билет
        </button>
      </div>
    </div>
  </div>

  <!-- Таблица билетов (для всех сеансов или конкретного) -->
  <div th:if="${selectedSessionId == null}">
    <h3 class="mb-3">Все билеты</h3>
    <div class="table-responsive">
      <table class="table table-striped">
        <thead class="table-dark">
        <tr>
          <th>ID Билета</th>
          <th>Сеанс</th>
          <th>Email Пользователя</th>
          <th>Ряд</th>
          <th>Место</th>
          <th>Цена</th>
          <th>Скидка</th>
          <th>Статус</th>
          <th>Действия</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="ticket : ${tickets}">
          <td th:text="${ticket.ticketId}"></td>
          <td th:text="${ticket.session != null ? ticket.session.film.name + ' - ' + ticket.session.date + ' ' + ticket.session.startTime + ' - Зал: ' + ticket.session.hall.hallId : 'Информация о сессии недоступна'}"></td>
          <td th:text="${ticket.user != null ? ticket.user.email : 'Не куплен'}"></td>
          <td th:text="${ticket.row}"></td>
          <td th:text="${ticket.seat}"></td>
          <td>
            <span th:if="${ticket.session != null && ticket.session.cost != null}">
              <span th:text="${#numbers.formatDecimal(ticket.finalPrice, 1, 'DEFAULT', 2, 'DEFAULT') + ' ₽'}"></span>
              <small th:if="${ticket.discount != null and ticket.discount.name() != 'NO_DISCOUNT'}"
                     class="text-muted d-block">
                (базовая: [[${#numbers.formatDecimal(ticket.session.cost, 1, 'DEFAULT', 2, 'DEFAULT')}]] ₽)
              </small>
            </span>
            <span th:unless="${ticket.session != null && ticket.session.cost != null}" class="text-muted">
              Не указана
            </span>
          </td>
          <td>
            <span th:if="${ticket.discount != null}"
                  th:text="${ticket.discount.label}"
                  class="badge bg-info">
            </span>
            <span th:unless="${ticket.discount != null}" class="badge bg-secondary">Нет скидки</span>
          </td>
          <td>
            <span th:if="${ticket.isPurchased}" class="badge bg-success">Куплен</span>
            <span th:unless="${ticket.isPurchased}" class="badge bg-warning">Свободен</span>
          </td>
          <td>
            <div th:if="${ticket.isPurchased}">
              <form th:action="@{/tickets/cancel}" method="post" class="d-inline">
                <input type="hidden" name="ticketId" th:value="${ticket.ticketId}"/>
                <button type="submit" class="btn btn-warning btn-sm"
                        onclick="return confirm('Отменить покупку этого билета?')">
                  Отменить
                </button>
              </form>
            </div>
            <div th:unless="${ticket.isPurchased}">
              <span class="text-muted">Свободен</span>
            </div>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Сообщения об успехе/ошибке -->
  <div th:if="${param.success}" class="alert alert-success alert-dismissible fade show">
    <span>Билет успешно куплен!</span>
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>

  <div th:if="${param.error}" class="alert alert-danger alert-dismissible fade show">
    <span th:text="${param.error}">Ошибка!</span>
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>
</div>

<!-- Модальное окно для покупки -->
<div class="modal fade" id="purchaseModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <form th:action="@{/tickets/purchase}" method="post">
        <input type="hidden" name="ticketId" id="purchaseTicketId">

        <div class="modal-header">
          <h5 class="modal-title">Покупка билета</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          <div id="modalSeatInfo" class="alert alert-info"></div>

          <!-- Отображение цены -->
          <div class="mb-3">
            <label class="form-label fw-bold">Стоимость билета:</label>
            <div class="price-display">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <span>Базовая цена:</span>
                <span id="modalBasePrice" class="text-muted"></span>
              </div>
              <div class="d-flex justify-content-between align-items-center mb-2">
                <span>Скидка:</span>
                <span id="modalDiscount" class="text-success"></span>
              </div>
              <hr>
              <div class="d-flex justify-content-between align-items-center">
                <span class="fw-bold">Итого к оплате:</span>
                <span id="modalFinalPrice" class="fw-bold fs-4 text-primary"></span>
              </div>
            </div>
          </div>

          <div class="mb-3">
            <label for="userEmail" class="form-label">Email пользователя:</label>
            <select id="userEmail" name="userEmail" class="form-select" required>
              <option value="">Выберите пользователя</option>
              <option th:each="user : ${users}"
                      th:value="${user.email}"
                      th:text="${user.email + ' (' + user.name + ')'}">
              </option>
            </select>
          </div>

          <div class="mb-3">
            <label for="discountType" class="form-label">Тип скидки:</label>
            <select id="discountType" name="discountType" class="form-select" onchange="updateFinalPrice()">
              <option th:each="type : ${discountTypes}"
                      th:value="${type}"
                      th:text="${type.label}">
              </option>
            </select>
          </div>
        </div>

        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Подтвердить покупку</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // Глобальные переменные
  let selectedSeat = null;
  let currentBasePrice = 0;

  // Factory Method для расчета скидки в JavaScript
  const discountCalculator = {
    calculatePrice: function(basePrice, discountType) {
      let multiplier = 1.0;
      let discountName = "Без скидки";
      let discountPercent = 0;

      switch(discountType) {
        case 'CHILD_DISCOUNT':
          multiplier = 0.5;
          discountName = "Детская скидка";
          discountPercent = 50;
          break;
        case 'STUDENT_DISCOUNT':
          multiplier = 0.7;
          discountName = "Студенческая скидка";
          discountPercent = 30;
          break;
        case 'SENIOR_DISCOUNT':
          multiplier = 0.8;
          discountName = "Пенсионная скидка";
          discountPercent = 20;
          break;
        case 'NO_DISCOUNT':
        default:
          multiplier = 1.0;
          discountName = "Без скидки";
          discountPercent = 0;
          break;
      }

      const finalPrice = basePrice * multiplier;
      const discountAmount = basePrice - finalPrice;

      return {
        basePrice: basePrice,
        finalPrice: finalPrice,
        discountName: discountName,
        discountPercent: discountPercent,
        discountAmount: discountAmount,
        multiplier: multiplier
      };
    }
  };

  // Функция выбора места
  function selectSeat(element) {
    // Сбрасываем предыдущее выделение
    if (selectedSeat) {
      selectedSeat.classList.remove('selected');
      selectedSeat.classList.add('available');
    }

    // Выделяем новое место
    element.classList.remove('available');
    element.classList.add('selected');
    selectedSeat = element;

    // Получаем информацию о месте
    const row = element.getAttribute('data-row');
    const seat = element.getAttribute('data-seat');
    const ticketId = element.getAttribute('data-ticketid');

    // Устанавливаем значения
    document.getElementById('selectedSeatText').textContent = `Ряд ${row}, Место ${seat}`;
    document.getElementById('purchaseTicketId').value = ticketId;
    document.getElementById('modalSeatInfo').textContent = `Ряд ${row}, Место ${seat}`;

    // Получаем базовую цену из данных сеанса
    const basePriceElement = document.querySelector('[th\\:text*="Базовая цена"]');
    if (basePriceElement) {
      const priceText = basePriceElement.textContent;
      const priceMatch = priceText.match(/(\d+[.,]\d+)/);
      if (priceMatch) {
        currentBasePrice = parseFloat(priceMatch[1].replace(',', '.'));
      }
    }

    // Если цена не найдена в сеансе, используем значение по умолчанию
    if (!currentBasePrice || isNaN(currentBasePrice)) {
      currentBasePrice = 500; // Цена по умолчанию
    }

    // Обновляем отображение цены
    updatePriceDisplay();

    // Показываем блок информации
    document.getElementById('selectedSeatInfo').style.display = 'block';
  }

  // Функция обновления цены
  function updateFinalPrice() {
    updatePriceDisplay();
  }

  // Функция обновления отображения цены
  function updatePriceDisplay() {
    const discountType = document.getElementById('discountType').value;
    const priceInfo = discountCalculator.calculatePrice(currentBasePrice, discountType);

    // Обновляем модальное окно
    document.getElementById('modalBasePrice').textContent = priceInfo.basePrice.toFixed(2) + ' ₽';
    document.getElementById('modalFinalPrice').textContent = priceInfo.finalPrice.toFixed(2) + ' ₽';

    if (priceInfo.discountPercent > 0) {
      document.getElementById('modalDiscount').textContent = `-${priceInfo.discountPercent}% (${priceInfo.discountAmount.toFixed(2)} ₽)`;
      document.getElementById('modalDiscount').className = 'text-success';
    } else {
      document.getElementById('modalDiscount').textContent = '0%';
      document.getElementById('modalDiscount').className = 'text-muted';
    }

    // Обновляем основное отображение
    document.getElementById('basePriceDisplay').textContent = priceInfo.basePrice.toFixed(2) + ' ₽';
    document.getElementById('finalPriceDisplay').textContent = priceInfo.finalPrice.toFixed(2) + ' ₽';

    let discountHtml = '';
    if (priceInfo.discountPercent > 0) {
      discountHtml = `
        <div class="d-flex justify-content-between">
          <span>Скидка (${priceInfo.discountPercent}%):</span>
          <span class="text-success">-${priceInfo.discountAmount.toFixed(2)} ₽</span>
        </div>
        <div class="text-success small mt-1">
          <i>${priceInfo.discountName}</i>
        </div>
      `;
    } else {
      discountHtml = '<div class="text-muted small">Без скидки</div>';
    }

    document.getElementById('discountDetails').innerHTML = discountHtml;

    // Подсветка выгоды
    if (priceInfo.discountPercent > 0) {
      document.getElementById('finalPriceDisplay').classList.add('text-success');
    } else {
      document.getElementById('finalPriceDisplay').classList.remove('text-success');
    }
  }

  // Инициализация при загрузке страницы
  document.addEventListener('DOMContentLoaded', function() {
    // Устанавливаем обработчик для модального окна
    const purchaseModal = document.getElementById('purchaseModal');
    if (purchaseModal) {
      purchaseModal.addEventListener('show.bs.modal', function() {
        updatePriceDisplay();
      });
    }

    // Инициализируем цену по умолчанию
    const basePriceElement = document.querySelector('[th\\:text*="Базовая цена"]');
    if (basePriceElement) {
      const priceText = basePriceElement.textContent;
      const priceMatch = priceText.match(/(\d+[.,]\d+)/);
      if (priceMatch) {
        currentBasePrice = parseFloat(priceMatch[1].replace(',', '.'));
      }
    }

    if (!currentBasePrice || isNaN(currentBasePrice)) {
      currentBasePrice = 500; // Цена по умолчанию
    }
  });

  // Функция для тестирования расчета цен
  function testPriceCalculation() {
    console.log('Тестирование Factory Method расчета цен:');

    const testCases = [
      { type: 'NO_DISCOUNT', basePrice: 1000, expected: 1000 },
      { type: 'CHILD_DISCOUNT', basePrice: 1000, expected: 500 },
      { type: 'STUDENT_DISCOUNT', basePrice: 1000, expected: 700 },
      { type: 'SENIOR_DISCOUNT', basePrice: 1000, expected: 800 }
    ];

    testCases.forEach(test => {
      const result = discountCalculator.calculatePrice(test.basePrice, test.type);
      console.log(`${test.type}: ${test.basePrice} -> ${result.finalPrice} (ожидалось: ${test.expected})`);
    });
  }

  // Раскомментируйте для тестирования:
  // testPriceCalculation();
</script>
</body>
</html>