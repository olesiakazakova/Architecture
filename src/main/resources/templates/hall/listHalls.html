<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Список залов</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <style>
        body {
          background-color: #f8f9fa;
          padding: 0;
          margin: 0;
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        nav {
          background: linear-gradient(135deg, #343a40, #495057);
          padding: 1rem 0;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
          margin-bottom: 30px;
        }

        nav a {
          color: white;
          text-decoration: none;
          padding: 0.5rem 1.5rem;
          margin: 0 0.5rem;
          border-radius: 5px;
          transition: all 0.3s ease;
          font-weight: 500;
        }

        nav a:hover {
          background-color: rgba(255,255,255,0.1);
          transform: translateY(-2px);
        }

        .container {
          max-width: 1200px;
          margin: 0 auto;
          background: white;
          padding: 20px;
          border-radius: 10px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
          margin-bottom: 20px;
          color: #343a40;
          font-size: 1.8rem;
        }

        .page-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 20px;
          padding-bottom: 15px;
          border-bottom: 1px solid #e9ecef;
        }

        .btn {
          padding: 10px 20px;
          border-radius: 5px;
          font-weight: bold;
          cursor: pointer;
          transition: all 0.3s ease;
          border: none;
          text-decoration: none;
          display: inline-block;
          text-align: center;
          font-size: 0.9rem;
        }

        .btn-primary {
          background: linear-gradient(135deg, #6f42c1, #59359d);
          color: white !important;
        }

        .btn-primary:hover {
          background: linear-gradient(135deg, #59359d, #4a2d82);
          transform: translateY(-2px);
          box-shadow: 0 4px 12px rgba(111,66,193,0.3);
        }

        .btn-secondary {
          background: linear-gradient(135deg, #6c757d, #545b62);
          color: white !important;
        }

        .btn-secondary:hover {
          background: linear-gradient(135deg, #545b62, #3d4246);
          transform: translateY(-2px);
          box-shadow: 0 4px 12px rgba(108,117,125,0.3);
        }

        .btn-warning {
          background: linear-gradient(135deg, #ffc107, #e0a800);
          color: #212529 !important;
        }

        .btn-warning:hover {
          background: linear-gradient(135deg, #e0a800, #d39e00);
        }

        .btn-danger {
          background: linear-gradient(135deg, #dc3545, #c82333);
          color: white !important;
        }

        .btn-danger:hover {
          background: linear-gradient(135deg, #c82333, #bd2130);
        }

        .btn-sm {
          padding: 6px 12px;
          font-size: 0.8rem;
        }

        .stats-grid {
          display: grid;
          grid-template-columns: repeat(4, 1fr);
          gap: 15px;
          margin-bottom: 25px;
        }

        .stat-card {
          background: #f8f9fa;
          padding: 15px;
          border-radius: 8px;
          text-align: center;
          border-left: 4px solid #6f42c1;
        }

        .stat-card h3 {
          margin: 0 0 10px 0;
          font-size: 0.9rem;
          color: #6c757d;
        }

        .stat-value {
          font-size: 1.8rem;
          font-weight: bold;
          color: #343a40;
          margin: 0;
        }

        .halls-table table {
          width: 100%;
          border-collapse: collapse;
          margin-top: 20px;
        }

        .halls-table th {
          background-color: #f8f9fa;
          padding: 12px 15px;
          text-align: left;
          font-weight: 600;
          color: #495057;
          border-bottom: 2px solid #dee2e6;
        }

        .halls-table td {
          padding: 12px 15px;
          border-bottom: 1px solid #dee2e6;
          vertical-align: top;
        }

        .halls-table tr:hover {
          background-color: #f8f9fa;
        }

        .hall-type {
          padding: 4px 8px;
          border-radius: 4px;
          font-size: 0.8rem;
          font-weight: 600;
        }

        .hall-type.standard {
          background-color: #e9ecef;
          color: #495057;
        }

        .hall-type.vip {
          background-color: #fff3cd;
          color: #856404;
        }

        .hall-type.imax {
          background-color: #d1ecf1;
          color: #0c5460;
        }

        .hall-features {
          display: flex;
          gap: 5px;
        }

        .feature-tag {
          background-color: #6f42c1;
          color: white;
          padding: 3px 8px;
          border-radius: 4px;
          font-size: 0.75rem;
          font-weight: 600;
        }

        .actions {
          display: flex;
          gap: 8px;
        }

        .empty-state {
          text-align: center;
          padding: 40px 20px;
        }

        .empty-state h3 {
          color: #6c757d;
          margin-bottom: 10px;
        }

        .empty-state p {
          color: #6c757d;
          margin-bottom: 20px;
        }

        .alert {
          padding: 12px 15px;
          border-radius: 5px;
          margin-bottom: 20px;
        }

        .alert-success {
          background-color: #d4edda;
          color: #155724;
          border: 1px solid #c3e6cb;
        }

        .alert-error {
          background-color: #f8d7da;
          color: #721c24;
          border: 1px solid #f5c6cb;
        }

        @media (max-width: 768px) {
          .container {
            padding: 15px;
          }

          nav {
            text-align: center;
          }

          nav a {
            display: inline-block;
            margin: 5px;
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
          }

          .page-header {
            flex-direction: column;
            gap: 15px;
            align-items: flex-start;
          }

          .stats-grid {
            grid-template-columns: repeat(2, 1fr);
          }

          .halls-table {
            overflow-x: auto;
          }

          .actions {
            flex-direction: column;
            gap: 5px;
          }
        }
    </style>
</head>
<body>
<nav>
    <a href="/films">Фильмы</a>
    <a href="/halls">Залы</a>
    <a href="/sessions">Сеансы</a>
    <a href="/tickets">Билеты</a>
    <a href="/orders" class="active">Заказы</a>
    <a href="/users">Пользователи</a>
</nav>

<div class="container">
    <div class="page-header">
        <h1>Список кинозалов</h1>
        <div>
            <a href="/halls/add" class="btn btn-primary">Добавить новый зал</a>
            <a href="/sessions" class="btn btn-secondary">Вернуться к сеансам</a>
        </div>
    </div>

    <!-- Сообщения об успехе/ошибке -->
    <div th:if="${param.success}" class="alert alert-success">
        Зал успешно добавлен/обновлен!
    </div>
    <div th:if="${param.deleteSuccess}" class="alert alert-success">
        Зал успешно удален!
    </div>
    <div th:if="${param.error}" class="alert alert-error">
        Произошла ошибка при выполнении операции.
    </div>

    <!-- Статистика -->
    <div class="stats-grid" th:if="${not #lists.isEmpty(halls)}">
        <div class="stat-card">
            <h3>Всего залов</h3>
            <p class="stat-value" th:text="${#lists.size(halls)}">0</p>
        </div>
        <div class="stat-card">
            <h3>Общее количество мест</h3>
            <p class="stat-value" th:text="${#aggregates.sum(halls.![numberSeats])}">0</p>
        </div>
        <div class="stat-card">
            <h3>Залы с 3D</h3>
            <p class="stat-value" th:text="${#aggregates.sum(halls.![has3d?1:0])}">0</p>
        </div>
        <div class="stat-card">
            <h3>Залы с Dolby</h3>
            <p class="stat-value" th:text="${#aggregates.sum(halls.![hasDolby?1:0])}">0</p>
        </div>
    </div>

    <div class="halls-table">
        <table>
            <thead>
            <tr>
                <th>ID</th>
                <th>Тип зала</th>
                <th>Количество мест</th>
                <th>Размер экрана</th>
                <th>Оснащение</th>
                <th>Описание</th>
                <th>Действия</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="hall : ${halls}">
                <td th:text="${hall.hallId}"></td>
                <td>
                    <span th:classappend="'hall-type ' + ${#strings.toLowerCase(hall.hallType)}"
                          th:text="${hall.hallType}">
                    </span>
                </td>
                <td th:text="${hall.numberSeats}"></td>
                <td>
                    <span th:if="${hall.screenSize > 0}"
                          th:text="${#numbers.formatDecimal(hall.screenSize, 1, 2)} + ' м'">
                    </span>
                    <span th:unless="${hall.screenSize > 0}">-</span>
                </td>
                <td>
                    <div class="hall-features">
                        <span th:if="${hall.has3d}" class="feature-tag">3D</span>
                        <span th:if="${hall.hasDolby}" class="feature-tag">Dolby</span>
                        <span th:if="${!hall.has3d && !hall.hasDolby}">-</span>
                    </div>
                </td>
                <td>
                    <span th:if="${hall.description}"
                          th:text="${#strings.abbreviate(hall.description, 30)}"
                          title="${hall.description}">
                    </span>
                    <span th:unless="${hall.description}">-</span>
                </td>
                <td>
                    <div class="actions">
                        <a th:href="@{/halls/edit/{id}(id=${hall.hallId})}"
                           class="btn btn-warning btn-sm">Редактировать</a>
                        <form th:action="@{/halls/delete/{id}(id=${hall.hallId})}"
                              method="post"
                              onsubmit="return confirm('Вы уверены, что хотите удалить зал ' + ${hall.hallId} + '?');"
                              style="margin: 0;">
                            <button type="submit" class="btn btn-danger btn-sm">Удалить</button>
                        </form>
                    </div>
                </td>
            </tr>
            <tr th:if="${#lists.isEmpty(halls)}">
                <td colspan="7">
                    <div class="empty-state">
                        <h3>Нет доступных залов</h3>
                        <p>Добавьте первый кинозал в систему</p>
                        <a href="/halls/add" class="btn btn-primary">Добавить зал</a>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    // Подтверждение удаления с дополнительной информацией
    function confirmDelete(form) {
        const hallId = form.getAttribute('action').split('/').pop();
        return confirm(`Вы уверены, что хотите удалить зал №${hallId}? Эта операция необратима.`);
    }

    // Добавляем обработчики для всех форм удаления
    document.addEventListener('DOMContentLoaded', function() {
        const deleteForms = document.querySelectorAll('form[action*="/delete/"]');
        deleteForms.forEach(form => {
            form.onsubmit = function() {
                return confirmDelete(this);
            };
        });
    });
</script>
</body>
</html>