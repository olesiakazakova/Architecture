<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Редактирование билета</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
<nav>
  <a href="/films">Фильмы</a>
  <a href="/sessions">Сеансы</a>
  <a href="/tickets">Билеты</a>
  <a href="/users">Пользователи</a>
</nav>
<h1>Редактирование билета</h1>

<div th:if="${param.error}">
  <p style="color: red">Ошибка: <span th:text="${param.error}"></span></p>
</div>

<form th:action="@{/tickets/edit}" method="post">
  <input type="hidden" name="ticketId" th:value="${ticket.ticketId}" />

  <label>Пользователь:</label>
  <select name="userEmail" required>
    <option value="" disabled>Выберите пользователя</option>
    <option th:each="user : ${users}"
            th:value="${user.email}"
            th:text="${user.name + ' (' + user.email + ')'}"
            th:selected="${ticket.user != null && user.email == ticket.user.email}">
    </option>
  </select>

  <label>Сеанс:</label>
  <select name="sessionId" required>
    <option value="" disabled>Выберите сеанс</option>
    <option th:each="cinemaSession : ${cinemaSessions}"
            th:value="${cinemaSession.sessionId}"
            th:text="${cinemaSession.film != null ? cinemaSession.film.name : 'Не указано'} +
                     ' - ' + ${cinemaSession.date != null ? cinemaSession.date : 'Не указано'} +
                     ' ' + ${cinemaSession.startTime != null ? #temporals.format(cinemaSession.startTime, 'HH:mm') : 'Не указано'} +
                     ' - Зал: ' + ${cinemaSession.hall != null ? cinemaSession.hall.hallId : 'Не указано'}"
            th:selected="${ticket.session != null && cinemaSession.sessionId == ticket.session.sessionId}">
    </option>
  </select>

  <label>Ряд:</label>
  <input type="number" name="row" th:value="${ticket.row}" required min="1" />

  <label>Место:</label>
  <input type="number" name="seat" th:value="${ticket.seat}" required min="1" />

  <label>Скидка:</label>
  <select name="discountType">
    <option value="" disabled>Выберите скидку</option>
    <option th:each="discountType : ${discountTypes}"
            th:value="${discountType}"
            th:text="${discountType}"
            th:selected="${ticket.discount == discountType}">
    </option>
  </select>

  <button type="submit">Сохранить изменения</button>
</form>

<a href="/tickets">Вернуться к списку билетов</a>

</body>
</html>